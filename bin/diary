#!/bin/sh

DEFAULT="# "

source $(til import lib)
DIARY_ROOT=$DOCS_ROOT/diary
ENTRY=$DIARY_ROOT/$(date +"%Y/%m")/$(date +"%d").$DOC_SUFFIX
HEADER="${1:-$DEFAULT} $(date +"%A - %D")"

show_help $1 "til diary - til logbook editor

USAGE til diary [options]

Opens a logbook/diary entry for the current day.

Options:
  -l|--list - list existing entries
"

case $1 in
   -l|--list)
      ls_clean $DIARY_ROOT
      ;;
   *)
      INITIAL=0
      init_file $ENTRY

      if [[ ! -s $ENTRY ]]; then
         echo "$HEADER" > $ENTRY
         INTITIAL=1
      fi

      _edit $ENTRY
      if [[ $? ]]; then
         git add $ENTRY
      elif [[ "$INITIAL" == "1" ]]; then
         rm $ENTRY
      fi
   ;;
esac
